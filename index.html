<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>별난별이 정보입력</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background-color: #e9dbf2;
      font-family: 'Pretendard', sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      padding-top: 40px;
    }

    input, select, button {
      font-family: 'Pretendard', sans-serif;
    }

    .character-image {
      width: 180px;
      margin-bottom: 30px;
    }

    .form-container {
      background-color: #fff;
      border-radius: 16px;
      padding: 24px;
      width: 90%;
      max-width: 400px;
      box-shadow: 0 3px 12px rgba(0, 0, 0, 0.1);
    }

    .form-container h2 {
      font-size: 16px;
      font-weight: 800;
      margin-bottom: 20px;
      color: #333;
      text-align: left;
    }

    .input-group {
      display: flex;
      flex-direction: column;
      margin-bottom: 16px;
    }

    .input-group label {
      font-size: 0.85rem;
      margin-bottom: 4px;
      color: #333;
      text-align: left;
      font-weight: 600;
    }

    .input-group input,
    .input-group select {
      appearance: none;
      -webkit-appearance: none;
      height: 38px;
      padding: 8px 12px;
      font-size: 0.85rem;
      border: 1px solid #ccc;
      border-radius: 6px;
      outline: none;
      background-color: white;
      color: #222;
    }

    .input-group input::placeholder {
      color: #aaa;
    }

    .input-group select {
      color: #aaa;
    }

    .input-group select:valid {
      color: #222;
    }

    .input-group small {
      font-size: 12px;
      color: #777;
      margin-top: 4px;
      text-align: left;
    }

    .submit-btn {
      display: block;
      margin-top: 16px;
      background-color: #2d1b69;
      color: white;
      border: none;
      padding: 8px 20px;
      border-radius: 20px;
      font-size: 14px;
      cursor: pointer;
      float: right;
    }

    .submit-btn:hover {
      opacity: 0.9;
    }
  </style>
</head>
<body>

  <img class="character-image" src="https://i.imgur.com/LNLszo5.png" alt="별난별이">

  <div class="form-container">
    <h2>🔮 너의 운명의 별을 위해, 살짝 알려줘! 🔮</h2>

    <div class="input-group">
      <label for="name">이름 (별명)</label>
      <input type="text" id="name" name="name" placeholder="예: 별난별">
    </div>

    <div class="input-group">
      <label for="birth">생년월일</label>
      <div style="position: relative; display: flex; align-items: center;">
        <input
          type="text"
          id="birth-text"
          name="birth"
          placeholder="YYYY-MM-DD (예: 2000-01-01)"
          pattern="\d{4}-\d{2}-\d{2}"
          style="
            width: 100%;
            height: 38px;
            padding: 8px 50px 8px 12px;
            font-size: 0.85rem;
            border: 1px solid #ccc;
            border-radius: 6px;
            outline: none;
            background-color: white;
            color: #222;
          "
          oninput="syncToCalendar()"
        >
        <input
          type="date"
          id="birth-calendar"
          onchange="syncToText()"
          onfocus="this.showPicker()"
          style="
            position: absolute;
            right: 0;
            width: 40px;
            height: 38px;
            border: none;
            background: transparent;
            cursor: pointer;
            color: transparent;
            outline: none;
          "
        >
      </div>
      <small>※ 직접 입력하거나 오른쪽 끝을 클릭해 달력을 열어주세요</small>
    </div>

    <div class="input-group">
      <label for="gender">성별</label>
      <select id="gender" name="gender" required>
        <option value="" disabled selected hidden>선택</option>
        <option value="남성">남성</option>
        <option value="여성">여성</option>
        <option value="기타">기타</option>
      </select>
    </div>

    <button type="button" class="submit-btn" onclick="goToZodiacPage()">결과보기</button>
  </div>

  <script>
    const zodiacUrls = {
      aries: "https://kimjiwoow.github.io/aries/",
      taurus: "https://kimjiwoow.github.io/taurus/",
      gemini: "https://kimjiwoow.github.io/gemini/",
      cancer: "https://kimjiwoow.github.io/crab1/ ",
      leo: "https://kimjiwoow.github.io/leo/",
      virgo: "https://kimjiwoow.github.io/virgo/",
      libra: " https://kimjiwoow.github.io/libra/ ",
      scorpio: " https://kimjiwoow.github.io/scrpiop/",
      sagittarius: "https://kimjiwoow.github.io/sagi/",
      capricorn: "https://kimjiwoow.github.io/capricor/",
      aquarius: " https://kimjiwoow.github.io/aquarius/",
      pisces: " https://kimjiwoow.github.io/pisces2/"
    };

    function getZodiacSign(month, day) {
      const zodiac = [
        { sign: "capricorn", start: [12, 22], end: [1, 19] },
        { sign: "aquarius", start: [1, 20], end: [2, 18] },
        { sign: "pisces", start: [2, 19], end: [3, 20] },
        { sign: "aries", start: [3, 21], end: [4, 19] },
        { sign: "taurus", start: [4, 20], end: [5, 20] },
        { sign: "gemini", start: [5, 21], end: [6, 21] },
        { sign: "cancer", start: [6, 22], end: [7, 22] },
        { sign: "leo", start: [7, 23], end: [8, 22] },
        { sign: "virgo", start: [8, 23], end: [9, 22] },
        { sign: "libra", start: [9, 23], end: [10, 22] },
        { sign: "scorpio", start: [10, 23], end: [11, 21] },
        { sign: "sagittarius", start: [11, 22], end: [12, 21] }
      ];

      for (const z of zodiac) {
        const [startMonth, startDay] = z.start;
        const [endMonth, endDay] = z.end;
        
        // 같은 해 내에서 처리되는 별자리
        if (startMonth <= endMonth) {
          if ((month === startMonth && day >= startDay) || 
              (month === endMonth && day <= endDay) ||
              (month > startMonth && month < endMonth)) {
            return z.sign;
          }
        } 
        // 연도를 넘나드는 별자리 (염소자리)
        else {
          if ((month === startMonth && day >= startDay) || 
              (month === endMonth && day <= endDay)) {
            return z.sign;
          }
        }
      }
      return null;
    }

    function syncToText() {
      const calendarValue = document.getElementById('birth-calendar').value;
      if (calendarValue) {
        document.getElementById('birth-text').value = calendarValue;
      }
    }

    function syncToCalendar() {
      const textValue = document.getElementById('birth-text').value;
      const datePattern = /^\d{4}-\d{2}-\d{2}$/;
      if (datePattern.test(textValue)) {
        document.getElementById('birth-calendar').value = textValue;
      }
    }

    function goToZodiacPage() {
      const name = document.getElementById("name").value.trim();
      const birth = document.getElementById("birth-text").value;
      const gender = document.getElementById("gender").value;

      if (!name) {
        alert("이름을 입력해 주세요!");
        return;
      }

      if (!birth) {
        alert("생년월일을 입력해 주세요!");
        return;
      }

      // 날짜 형식 검증
      const datePattern = /^\d{4}-\d{2}-\d{2}$/;
      if (!datePattern.test(birth)) {
        alert("날짜 형식이 올바르지 않습니다. (예: 2000-01-01)");
        return;
      }

      if (!gender) {
        alert("성별을 선택해 주세요!");
        return;
      }

      const [year, month, day] = birth.split("-").map(Number);
      
      // 날짜 유효성 검사
      if (year < 1900 || year > 2030 || month < 1 || month > 12 || day < 1 || day > 31) {
        alert("올바른 날짜를 입력해 주세요!");
        return;
      }

      const sign = getZodiacSign(month, day);

      if (!sign) {
        alert("별자리를 확인할 수 없습니다. 날짜를 다시 확인해 주세요!");
        return;
      }

      if (!zodiacUrls[sign]) {
        alert("아직 연결된 별자리 페이지가 없어요!");
        return;
      }

      const url = zodiacUrls[sign];
      window.location.href = url;
    }
  </script>
<script>
  async function sendUserDataToSheet() {
    const endpoint = "https://script.google.com/macros/s/AKfycbzQoq68uBzNG73O0tB_KGIsFYfjvuc9zDQKgyrd3JGl2U1tKX8x6iTZ_FghTV4v--JKgQ/exec";

    // 예시 데이터 (실제 입력값으로 교체하세요)
    const data = {
      sessionId: "session_001",
      name: "홍길동",
      birth: "1990-01-01",
      gender: "남성",
      zodiac: "염소자리",
      totalTime: 42,
      actions: [
        { time: "2025-06-08 10:00:00", action: "start_input", value: "", timeFromStart: 0 },
        { time: "2025-06-08 10:00:10", action: "name_input_done", value: "홍길동", timeFromStart: 10 },
        { time: "2025-06-08 10:00:20", action: "birth_input_done", value: "1990-01-01", timeFromStart: 20 },
        { time: "2025-06-08 10:00:30", action: "gender_input_done", value: "남성", timeFromStart: 30 },
        { time: "2025-06-08 10:00:42", action: "result_click", value: "", timeFromStart: 42 }
      ]
    };

    try {
      const response = await fetch(endpoint, {
        method: "POST",
        mode: "cors",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(data)
      });

      const result = await response.json();
      if (result.success) {
        console.log("✅ 전송 성공:", result);
        alert("데이터가 성공적으로 저장되었습니다!");
      } else {
        console.error("❌ 전송 실패:", result);
        alert("데이터 저장 중 오류가 발생했습니다.");
      }
    } catch (error) {
      console.error("❗ 요청 실패:", error);
      alert("서버와 연결할 수 없습니다.");
    }
  }

  // 예시: 버튼 클릭 시 실행
  document.getElementById("sendButton").addEventListener("click", sendUserDataToSheet);
</script>

<!-- 예시 버튼 -->
<button id="sendButton">데이터 전송</button>

</body>
</html>
