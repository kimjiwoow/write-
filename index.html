<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ë³„ë‚œë³„ì´ ì •ë³´ì…ë ¥</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background-color: #e9dbf2;
      font-family: 'Pretendard', sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      padding-top: 40px;
    }

    input, select, button {
      font-family: 'Pretendard', sans-serif;
    }

    .character-image {
      width: 180px;
      margin-bottom: 30px;
    }

    .form-container {
      background-color: #fff;
      border-radius: 16px;
      padding: 24px;
      width: 90%;
      max-width: 400px;
      box-shadow: 0 3px 12px rgba(0, 0, 0, 0.1);
    }

    .form-container h2 {
      font-size: 16px;
      font-weight: 800;
      margin-bottom: 20px;
      color: #333;
      text-align: left;
    }

    .input-group {
      display: flex;
      flex-direction: column;
      margin-bottom: 16px;
    }

    .input-group label {
      font-size: 0.85rem;
      margin-bottom: 4px;
      color: #333;
      text-align: left;
      font-weight: 600;
    }

    .input-group input,
    .input-group select {
      appearance: none;
      -webkit-appearance: none;
      height: 38px;
      padding: 8px 12px;
      font-size: 0.85rem;
      border: 1px solid #ccc;
      border-radius: 6px;
      outline: none;
      background-color: white;
      color: #222;
    }

    .input-group input::placeholder {
      color: #aaa;
    }

    .input-group select {
      color: #aaa;
    }

    .input-group select:valid {
      color: #222;
    }

    .input-group small {
      font-size: 12px;
      color: #777;
      margin-top: 4px;
      text-align: left;
    }

    .submit-btn {
      display: block;
      margin-top: 16px;
      background-color: #2d1b69;
      color: white;
      border: none;
      padding: 8px 20px;
      border-radius: 20px;
      font-size: 14px;
      cursor: pointer;
      float: right;
    }

    .submit-btn:hover {
      opacity: 0.9;
    }
  </style>
</head>
<body>

  <img class="character-image" src="https://i.imgur.com/LNLszo5.png" alt="ë³„ë‚œë³„ì´">

  <div class="form-container">
    <h2>ğŸ”® ë„ˆì˜ ìš´ëª…ì˜ ë³„ì„ ìœ„í•´, ì‚´ì§ ì•Œë ¤ì¤˜! ğŸ”®</h2>

    <div class="input-group">
      <label for="name">ì´ë¦„ (ë³„ëª…)</label>
      <input type="text" id="name" name="name" placeholder="ì˜ˆ: ë³„ë‚œë³„">
    </div>

    <div class="input-group">
      <label for="birth">ìƒë…„ì›”ì¼</label>
      <div style="position: relative; display: flex; align-items: center;">
        <input
          type="text"
          id="birth-text"
          name="birth"
          placeholder="YYYY-MM-DD (ì˜ˆ: 2000-01-01)"
          pattern="\d{4}-\d{2}-\d{2}"
          style="
            width: 100%;
            height: 38px;
            padding: 8px 50px 8px 12px;
            font-size: 0.85rem;
            border: 1px solid #ccc;
            border-radius: 6px;
            outline: none;
            background-color: white;
            color: #222;
          "
          oninput="syncToCalendar()"
        >
        <input
          type="date"
          id="birth-calendar"
          onchange="syncToText()"
          onfocus="this.showPicker()"
          style="
            position: absolute;
            right: 0;
            width: 40px;
            height: 38px;
            border: none;
            background: transparent;
            cursor: pointer;
            color: transparent;
            outline: none;
          "
        >
      </div>
      <small>â€» ì§ì ‘ ì…ë ¥í•˜ê±°ë‚˜ ì˜¤ë¥¸ìª½ ëì„ í´ë¦­í•´ ë‹¬ë ¥ì„ ì—´ì–´ì£¼ì„¸ìš”</small>
    </div>

    <div class="input-group">
      <label for="gender">ì„±ë³„</label>
      <select id="gender" name="gender" required>
        <option value="" disabled selected hidden>ì„ íƒ</option>
        <option value="ë‚¨ì„±">ë‚¨ì„±</option>
        <option value="ì—¬ì„±">ì—¬ì„±</option>
        <option value="ê¸°íƒ€">ê¸°íƒ€</option>
      </select>
    </div>

    <button type="button" class="submit-btn" onclick="goToZodiacPage()">ê²°ê³¼ë³´ê¸°</button>
  </div>

  <script>
    const zodiacUrls = {
      aries: "https://kimjiwoow.github.io/aries/",
      taurus: "https://kimjiwoow.github.io/taurus/",
      gemini: "https://kimjiwoow.github.io/gemini/",
      cancer: "https://kimjiwoow.github.io/crab1/ ",
      leo: "https://kimjiwoow.github.io/leo/",
      virgo: "https://kimjiwoow.github.io/virgo/",
      libra: " https://kimjiwoow.github.io/libra/ ",
      scorpio: " https://kimjiwoow.github.io/scrpiop/",
      sagittarius: "https://kimjiwoow.github.io/sagi/",
      capricorn: "https://kimjiwoow.github.io/capricor/",
      aquarius: " https://kimjiwoow.github.io/aquarius/",
      pisces: " https://kimjiwoow.github.io/pisces2/"
    };

    function getZodiacSign(month, day) {
      const zodiac = [
        { sign: "capricorn", start: [12, 22], end: [1, 19] },
        { sign: "aquarius", start: [1, 20], end: [2, 18] },
        { sign: "pisces", start: [2, 19], end: [3, 20] },
        { sign: "aries", start: [3, 21], end: [4, 19] },
        { sign: "taurus", start: [4, 20], end: [5, 20] },
        { sign: "gemini", start: [5, 21], end: [6, 21] },
        { sign: "cancer", start: [6, 22], end: [7, 22] },
        { sign: "leo", start: [7, 23], end: [8, 22] },
        { sign: "virgo", start: [8, 23], end: [9, 22] },
        { sign: "libra", start: [9, 23], end: [10, 22] },
        { sign: "scorpio", start: [10, 23], end: [11, 21] },
        { sign: "sagittarius", start: [11, 22], end: [12, 21] }
      ];

      for (const z of zodiac) {
        const [startMonth, startDay] = z.start;
        const [endMonth, endDay] = z.end;
        
        // ê°™ì€ í•´ ë‚´ì—ì„œ ì²˜ë¦¬ë˜ëŠ” ë³„ìë¦¬
        if (startMonth <= endMonth) {
          if ((month === startMonth && day >= startDay) || 
              (month === endMonth && day <= endDay) ||
              (month > startMonth && month < endMonth)) {
            return z.sign;
          }
        } 
        // ì—°ë„ë¥¼ ë„˜ë‚˜ë“œëŠ” ë³„ìë¦¬ (ì—¼ì†Œìë¦¬)
        else {
          if ((month === startMonth && day >= startDay) || 
              (month === endMonth && day <= endDay)) {
            return z.sign;
          }
        }
      }
      return null;
    }

    function syncToText() {
      const calendarValue = document.getElementById('birth-calendar').value;
      if (calendarValue) {
        document.getElementById('birth-text').value = calendarValue;
      }
    }

    function syncToCalendar() {
      const textValue = document.getElementById('birth-text').value;
      const datePattern = /^\d{4}-\d{2}-\d{2}$/;
      if (datePattern.test(textValue)) {
        document.getElementById('birth-calendar').value = textValue;
      }
    }

    function goToZodiacPage() {
      const name = document.getElementById("name").value.trim();
      const birth = document.getElementById("birth-text").value;
      const gender = document.getElementById("gender").value;

      if (!name) {
        alert("ì´ë¦„ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”!");
        return;
      }

      if (!birth) {
        alert("ìƒë…„ì›”ì¼ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”!");
        return;
      }

      // ë‚ ì§œ í˜•ì‹ ê²€ì¦
      const datePattern = /^\d{4}-\d{2}-\d{2}$/;
      if (!datePattern.test(birth)) {
        alert("ë‚ ì§œ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤. (ì˜ˆ: 2000-01-01)");
        return;
      }

      if (!gender) {
        alert("ì„±ë³„ì„ ì„ íƒí•´ ì£¼ì„¸ìš”!");
        return;
      }

      const [year, month, day] = birth.split("-").map(Number);
      
      // ë‚ ì§œ ìœ íš¨ì„± ê²€ì‚¬
      if (year < 1900 || year > 2030 || month < 1 || month > 12 || day < 1 || day > 31) {
        alert("ì˜¬ë°”ë¥¸ ë‚ ì§œë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”!");
        return;
      }

      const sign = getZodiacSign(month, day);

      if (!sign) {
        alert("ë³„ìë¦¬ë¥¼ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‚ ì§œë¥¼ ë‹¤ì‹œ í™•ì¸í•´ ì£¼ì„¸ìš”!");
        return;
      }

      if (!zodiacUrls[sign]) {
        alert("ì•„ì§ ì—°ê²°ëœ ë³„ìë¦¬ í˜ì´ì§€ê°€ ì—†ì–´ìš”!");
        return;
      }

      const url = zodiacUrls[sign];
      window.location.href = url;
    }
  </script>
<script>
  async function sendUserDataToSheet() {
    const endpoint = "https://script.google.com/macros/s/AKfycbzQoq68uBzNG73O0tB_KGIsFYfjvuc9zDQKgyrd3JGl2U1tKX8x6iTZ_FghTV4v--JKgQ/exec";

    // ì˜ˆì‹œ ë°ì´í„° (ì‹¤ì œ ì…ë ¥ê°’ìœ¼ë¡œ êµì²´í•˜ì„¸ìš”)
    const data = {
      sessionId: "session_001",
      name: "í™ê¸¸ë™",
      birth: "1990-01-01",
      gender: "ë‚¨ì„±",
      zodiac: "ì—¼ì†Œìë¦¬",
      totalTime: 42,
      actions: [
        { time: "2025-06-08 10:00:00", action: "start_input", value: "", timeFromStart: 0 },
        { time: "2025-06-08 10:00:10", action: "name_input_done", value: "í™ê¸¸ë™", timeFromStart: 10 },
        { time: "2025-06-08 10:00:20", action: "birth_input_done", value: "1990-01-01", timeFromStart: 20 },
        { time: "2025-06-08 10:00:30", action: "gender_input_done", value: "ë‚¨ì„±", timeFromStart: 30 },
        { time: "2025-06-08 10:00:42", action: "result_click", value: "", timeFromStart: 42 }
      ]
    };

    try {
      const response = await fetch(endpoint, {
        method: "POST",
        mode: "cors",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(data)
      });

      const result = await response.json();
      if (result.success) {
        console.log("âœ… ì „ì†¡ ì„±ê³µ:", result);
        alert("ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!");
      } else {
        console.error("âŒ ì „ì†¡ ì‹¤íŒ¨:", result);
        alert("ë°ì´í„° ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
      }
    } catch (error) {
      console.error("â— ìš”ì²­ ì‹¤íŒ¨:", error);
      alert("ì„œë²„ì™€ ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
    }
  }

  // ì˜ˆì‹œ: ë²„íŠ¼ í´ë¦­ ì‹œ ì‹¤í–‰
  document.getElementById("sendButton").addEventListener("click", sendUserDataToSheet);
</script>

<!-- ì˜ˆì‹œ ë²„íŠ¼ -->
<button id="sendButton">ë°ì´í„° ì „ì†¡</button>

</body>
</html>
