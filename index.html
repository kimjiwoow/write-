<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ë³„ë‚œë³„ì´ ì •ë³´ì…ë ¥</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background-color: #e9dbf2;
      font-family: 'Pretendard', sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      padding-top: 40px;
    }

    input, select, button {
      font-family: 'Pretendard', sans-serif;
    }

    .character-image {
      width: 180px;
      margin-bottom: 30px;
    }

    .form-container {
      background-color: #fff;
      border-radius: 16px;
      padding: 24px;
      width: 90%;
      max-width: 400px;
      box-shadow: 0 3px 12px rgba(0, 0, 0, 0.1);
    }

    .form-container h2 {
      font-size: 16px;
      font-weight: 800;
      margin-bottom: 20px;
      color: #333;
      text-align: left;
    }

    .input-group {
      display: flex;
      flex-direction: column;
      margin-bottom: 16px;
    }

    .input-group label {
      font-size: 0.85rem;
      margin-bottom: 4px;
      color: #333;
      text-align: left;
      font-weight: 600;
    }

    .input-group input,
    .input-group select {
      appearance: none;
      -webkit-appearance: none;
      height: 38px;
      padding: 8px 12px;
      font-size: 0.85rem;
      border: 1px solid #ccc;
      border-radius: 6px;
      outline: none;
      background-color: white;
      color: #222;
    }

    .input-group input::placeholder {
      color: #aaa;
    }

    .input-group select {
      color: #aaa;
    }

    .input-group select:valid {
      color: #222;
    }

    .input-group small {
      font-size: 12px;
      color: #777;
      margin-top: 4px;
      text-align: left;
    }

    .submit-btn {
      display: block;
      margin-top: 16px;
      background-color: #2d1b69;
      color: white;
      border: none;
      padding: 8px 20px;
      border-radius: 20px;
      font-size: 14px;
      cursor: pointer;
      float: right;
    }

    .submit-btn:hover {
      opacity: 0.9;
    }

    .submit-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
  </style>
</head>
<body>

  <img class="character-image" src="https://i.imgur.com/LNLszo5.png" alt="ë³„ë‚œë³„ì´">

  <div class="form-container">
    <h2>ğŸ”® ë„ˆì˜ ìš´ëª…ì˜ ë³„ì„ ìœ„í•´, ì‚´ì§ ì•Œë ¤ì¤˜! ğŸ”®</h2>

    <div class="input-group">
      <label for="name">ì´ë¦„ (ë³„ëª…)</label>
      <input type="text" id="name" name="name" placeholder="ì˜ˆ: ë³„ë‚œë³„">
    </div>

    <div class="input-group">
      <label for="birth">ìƒë…„ì›”ì¼</label>
      <div style="position: relative; display: flex; align-items: center;">
        <input
          type="text"
          id="birth-text"
          name="birth"
          placeholder="YYYY-MM-DD (ì˜ˆ: 2000-01-01)"
          pattern="\d{4}-\d{2}-\d{2}"
          style="
            width: 100%;
            height: 38px;
            padding: 8px 50px 8px 12px;
            font-size: 0.85rem;
            border: 1px solid #ccc;
            border-radius: 6px;
            outline: none;
            background-color: white;
            color: #222;
          "
          oninput="syncToCalendar()"
        >
        <input
          type="date"
          id="birth-calendar"
          onchange="syncToText()"
          onfocus="this.showPicker()"
          style="
            position: absolute;
            right: 0;
            width: 40px;
            height: 38px;
            border: none;
            background: transparent;
            cursor: pointer;
            color: transparent;
            outline: none;
          "
        >
      </div>
      <small>â€» ì§ì ‘ ì…ë ¥í•˜ê±°ë‚˜ ì˜¤ë¥¸ìª½ ëì„ í´ë¦­í•´ ë‹¬ë ¥ì„ ì—´ì–´ì£¼ì„¸ìš”</small>
    </div>

    <div class="input-group">
      <label for="gender">ì„±ë³„</label>
      <select id="gender" name="gender" required>
        <option value="" disabled selected hidden>ì„ íƒ</option>
        <option value="ë‚¨ì„±">ë‚¨ì„±</option>
        <option value="ì—¬ì„±">ì—¬ì„±</option>
        <option value="ê¸°íƒ€">ê¸°íƒ€</option>
      </select>
    </div>

    <button type="button" class="submit-btn" onclick="goToZodiacPage()" id="submitBtn">ê²°ê³¼ë³´ê¸°</button>
  </div>

  <script>
    // âœ… êµ¬ê¸€ ì•±ìŠ¤ ìŠ¤í¬ë¦½íŠ¸ ì›¹ì•± URL (í•œ ë²ˆë§Œ ì„ ì–¸)
    const WEBAPP_URL = 'https://script.google.com/macros/s/AKfycbyQksOBt6Rg11usuNVaHOLbZ8Oe2Ctn0ZPGHiK_0r1sIX5btX4RRMqb8GMFCTRR4mc0/exec';
    
    // ì„¸ì…˜ ì‹œì‘ ì‹œê°„ê³¼ í–‰ë™ ë¡œê·¸
    const sessionStartTime = Date.now();
    const sessionId = 'session_' + sessionStartTime;
    const actionLog = [];

    // í–‰ë™ ë¡œê·¸ ê¸°ë¡ í•¨ìˆ˜
    function logAction(action, value = null) {
      const currentTime = Date.now();
      const timeFromStart = Math.round((currentTime - sessionStartTime) / 1000);
      
      actionLog.push({
        action: action,
        time: new Date().toLocaleTimeString(),
        timeFromStart: timeFromStart,
        value: value
      });
      
      console.log(`í–‰ë™ ê¸°ë¡: ${action}`, value);
    }

    // âœ… ë³„ìë¦¬ URL ë§¤í•‘
    const zodiacUrls = {
      aries: "https://kimjiwoow.github.io/aries/",
      taurus: "https://kimjiwoow.github.io/taurus/",
      gemini: "https://kimjiwoow.github.io/gemini/",
      cancer: "https://kimjiwoow.github.io/crab1/",
      leo: "https://kimjiwoow.github.io/leo/",
      virgo: "https://kimjiwoow.github.io/virgo/",
      libra: "https://kimjiwoow.github.io/libra/",
      scorpio: "https://kimjiwoow.github.io/scrpiop/",
      sagittarius: "https://kimjiwoow.github.io/sagi/",
      capricorn: "https://kimjiwoow.github.io/capricor/",
      aquarius: "https://kimjiwoow.github.io/aquarius/",
      pisces: "https://kimjiwoow.github.io/pisces2/"
    };

    // âœ… ë³„ìë¦¬ ê³„ì‚° í•¨ìˆ˜
    function getZodiacSign(month, day) {
      const zodiac = [
        { sign: "capricorn", start: [12, 22], end: [1, 19] },
        { sign: "aquarius", start: [1, 20], end: [2, 18] },
        { sign: "pisces", start: [2, 19], end: [3, 20] },
        { sign: "aries", start: [3, 21], end: [4, 19] },
        { sign: "taurus", start: [4, 20], end: [5, 20] },
        { sign: "gemini", start: [5, 21], end: [6, 21] },
        { sign: "cancer", start: [6, 22], end: [7, 22] },
        { sign: "leo", start: [7, 23], end: [8, 22] },
        { sign: "virgo", start: [8, 23], end: [9, 22] },
        { sign: "libra", start: [9, 23], end: [10, 22] },
        { sign: "scorpio", start: [10, 23], end: [11, 21] },
        { sign: "sagittarius", start: [11, 22], end: [12, 21] }
      ];

      for (const z of zodiac) {
        const [startMonth, startDay] = z.start;
        const [endMonth, endDay] = z.end;
        
        if (startMonth <= endMonth) {
          if ((month === startMonth && day >= startDay) || 
              (month === endMonth && day <= endDay) ||
              (month > startMonth && month < endMonth)) {
            return z.sign;
          }
        } else {
          if ((month === startMonth && day >= startDay) || 
              (month === endMonth && day <= endDay)) {
            return z.sign;
          }
        }
      }
      return null;
    }

    // âœ… ë‚ ì§œ ë™ê¸°í™” í•¨ìˆ˜ë“¤
    function syncToText() {
      const calendarValue = document.getElementById('birth-calendar').value;
      if (calendarValue) {
        document.getElementById('birth-text').value = calendarValue;
        logAction('birth_calendar_selected', calendarValue);
      }
    }

    function syncToCalendar() {
      const textValue = document.getElementById('birth-text').value;
      const datePattern = /^\d{4}-\d{2}-\d{2}$/;
      if (datePattern.test(textValue)) {
        document.getElementById('birth-calendar').value = textValue;
        logAction('birth_text_input', textValue);
      }
    }

    // âœ… êµ¬ê¸€ ì‹œíŠ¸ ë°ì´í„° ì „ì†¡ í•¨ìˆ˜
    async function sendToGoogleSheet(userData) {
        try {
            console.log('ğŸ“¤ êµ¬ê¸€ ì‹œíŠ¸ë¡œ ë°ì´í„° ì „ì†¡ ì¤‘...', userData);
            
            const response = await fetch(WEBAPP_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(userData)
            });
            
            const result = await response.json();
            console.log('ğŸ“‹ ì „ì†¡ ê²°ê³¼:', result);
            
            if (result.success) {
                console.log('âœ… ë°ì´í„° ì €ì¥ ì„±ê³µ!', result.spreadsheetUrl);
                return true;
            } else {
                console.error('âŒ ì €ì¥ ì‹¤íŒ¨:', result.error);
                return false;
            }
            
        } catch (error) {
            console.error('ğŸš¨ ì „ì†¡ ì˜¤ë¥˜:', error);
            return false;
        }
    }

    // âœ… ë©”ì¸ í•¨ìˆ˜ - ë³„ìë¦¬ í˜ì´ì§€ë¡œ ì´ë™
    async function goToZodiacPage() {
      const submitBtn = document.getElementById('submitBtn');
      submitBtn.disabled = true;
      submitBtn.textContent = 'ì²˜ë¦¬ì¤‘...';
      
      logAction('result_button_clicked');
      
      const name = document.getElementById("name").value.trim();
      const birth = document.getElementById("birth-text").value;
      const gender = document.getElementById("gender").value;

      // ì…ë ¥ ê²€ì¦
      if (!name) {
        alert("ì´ë¦„ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”!");
        submitBtn.disabled = false;
        submitBtn.textContent = 'ê²°ê³¼ë³´ê¸°';
        return;
      }

      if (!birth) {
        alert("ìƒë…„ì›”ì¼ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”!");
        submitBtn.disabled = false;
        submitBtn.textContent = 'ê²°ê³¼ë³´ê¸°';
        return;
      }

      const datePattern = /^\d{4}-\d{2}-\d{2}$/;
      if (!datePattern.test(birth)) {
        alert("ë‚ ì§œ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤. (ì˜ˆ: 2000-01-01)");
        submitBtn.disabled = false;
        submitBtn.textContent = 'ê²°ê³¼ë³´ê¸°';
        return;
      }

      if (!gender) {
        alert("ì„±ë³„ì„ ì„ íƒí•´ ì£¼ì„¸ìš”!");
        submitBtn.disabled = false;
        submitBtn.textContent = 'ê²°ê³¼ë³´ê¸°';
        return;
      }

      const [year, month, day] = birth.split("-").map(Number);
      
      if (year < 1900 || year > 2030 || month < 1 || month > 12 || day < 1 || day > 31) {
        alert("ì˜¬ë°”ë¥¸ ë‚ ì§œë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”!");
        submitBtn.disabled = false;
        submitBtn.textContent = 'ê²°ê³¼ë³´ê¸°';
        return;
      }

      const sign = getZodiacSign(month, day);

      if (!sign) {
        alert("ë³„ìë¦¬ë¥¼ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‚ ì§œë¥¼ ë‹¤ì‹œ í™•ì¸í•´ ì£¼ì„¸ìš”!");
        submitBtn.disabled = false;
        submitBtn.textContent = 'ê²°ê³¼ë³´ê¸°';
        return;
      }

      if (!zodiacUrls[sign]) {
        alert("ì•„ì§ ì—°ê²°ëœ ë³„ìë¦¬ í˜ì´ì§€ê°€ ì—†ì–´ìš”!");
        submitBtn.disabled = false;
        submitBtn.textContent = 'ê²°ê³¼ë³´ê¸°';
        return;
      }

      // ìµœì¢… ë¡œê·¸ ê¸°ë¡
      logAction('form_completed', { name, birth, gender, zodiac: sign });
      
      // ì „ì²´ ì†Œìš” ì‹œê°„ ê³„ì‚°
      const totalTime = Math.round((Date.now() - sessionStartTime) / 1000);
      
      // êµ¬ê¸€ ì‹œíŠ¸ë¡œ ì „ì†¡í•  ë°ì´í„° ì¤€ë¹„
      const userData = {
        sessionId: sessionId,
        name: name,
        birth: birth,
        gender: gender,
        zodiac: sign,
        date: new Date().toLocaleDateString('ko-KR'),
        time: new Date().toLocaleTimeString('ko-KR'),
        totalTime: totalTime,
        actions: actionLog
      };
      
      // êµ¬ê¸€ ì‹œíŠ¸ë¡œ ë°ì´í„° ì „ì†¡
      console.log('ğŸš€ êµ¬ê¸€ ì‹œíŠ¸ ì „ì†¡ ì‹œì‘...');
      console.log('ì „ì†¡í•  ë°ì´í„°:', userData);
      
      const success = await sendToGoogleSheet(userData);
      
      if (success) {
        console.log('ğŸ‰ ë°ì´í„° ì „ì†¡ ì™„ë£Œ! ë³„ìë¦¬ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.');
        // ì§§ì€ ì§€ì—° í›„ ì´ë™ (ë°ì´í„° ì €ì¥ ì™„ë£Œ ëŒ€ê¸°)
        setTimeout(() => {
          window.location.href = zodiacUrls[sign];
        }, 1000);
      } else {
        console.log('âš ï¸ ë°ì´í„° ì „ì†¡ ì‹¤íŒ¨, í•˜ì§€ë§Œ ë³„ìë¦¬ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.');
        // ì‹¤íŒ¨í•´ë„ í˜ì´ì§€ëŠ” ì´ë™
        setTimeout(() => {
          window.location.href = zodiacUrls[sign];
        }, 500);
      }
    }

    // âœ… í˜ì´ì§€ ë¡œë“œ ë° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
    window.onload = function() {
      logAction('page_loaded');
    };

    // DOM ì¤€ë¹„ ì™„ë£Œ í›„ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('name').addEventListener('input', function() {
        if (this.value.trim()) {
          logAction('name_input', this.value);
        }
      });
      
      document.getElementById('gender').addEventListener('change', function() {
        logAction('gender_selected', this.value);
      });
      
      document.getElementById('birth-text').addEventListener('input', function() {
        if (this.value.trim()) {
          logAction('birth_input', this.value);
        }
      });
    });

  </script>

</body>
</html>
